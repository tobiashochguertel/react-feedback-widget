version: '3'

# =============================================================================
# React Visual Feedback - Taskfile Configuration
# =============================================================================
# Smart deployment orchestration with:
# - Status checks (skip if already running)
# - Source fingerprinting (rebuild only on changes)
# - Platform-specific commands
# - Preconditions (validate environment)
# - Prompts for destructive operations
#
# Reference: https://taskfile.dev
# =============================================================================

vars:
  ROOT_DIR: '{{.ROOT_DIR}}'
  LIB_DIR: '{{.ROOT_DIR}}/packages/react-visual-feedback'
  EXAMPLE_DIR: '{{.ROOT_DIR}}/packages/feedback-example'
  API_DIR: '{{.ROOT_DIR}}/packages/feedback-server-api'
  GENERATED_DIR: '{{.ROOT_DIR}}/packages/generated'
  SERVER_DIR: '{{.ROOT_DIR}}/packages/feedback-server'
  WEBUI_DIR: '{{.ROOT_DIR}}/packages/feedback-server-webui'
  # Ports - using custom high-range ports to avoid conflicts with common services
  # PostgreSQL: 18229, Feedback Server: 15567, WebUI: 19568, Example: 18196
  POSTGRES_PORT: '{{.POSTGRES_PORT | default "18229"}}'
  SERVER_PORT: '{{.FEEDBACK_SERVER_PORT | default "15567"}}'
  WEBUI_PORT: '{{.WEBUI_PORT | default "19568"}}'
  EXAMPLE_PORT: '{{.EXAMPLE_PORT | default "18196"}}'

# Include child Taskfiles
includes:
  api:
    taskfile: ./packages/feedback-server-api/Taskfile.yml
    dir: ./packages/feedback-server-api
    optional: true
  bdd:
    taskfile: ./tests/bdd/deployment/Taskfile.yml
    dir: ./tests/bdd/deployment
    optional: true

tasks:
  # ============================================================================
  # Internal Helper Tasks
  # ============================================================================

  _docker:check:
    desc: Check if Docker daemon is running (internal)
    internal: true
    silent: true
    preconditions:
      - sh: command -v docker
        msg: 'Docker is not installed. Please install Docker Desktop: https://docker.com/get-started'
      - sh: docker info >/dev/null 2>&1
        msg: 'Docker daemon is not running. Please start Docker Desktop.'

  _docker:compose:check:
    desc: Check if docker compose is available (internal)
    internal: true
    silent: true
    preconditions:
      - sh: docker compose version >/dev/null 2>&1
        msg: 'Docker Compose V2 is not available. Please update Docker Desktop.'

  _container:running:
    desc: Check if a specific container is running (internal)
    internal: true
    silent: true
    vars:
      CONTAINER: '{{.CONTAINER}}'
    cmds:
      - docker compose ps --format json | grep -q '"{{.CONTAINER}}".*"running"'

  _port:available:
    desc: Check if a port is available (internal)
    internal: true
    silent: true
    vars:
      PORT: '{{.PORT}}'
    platforms: [darwin, linux]
    cmds:
      - '! lsof -i :{{.PORT}} >/dev/null 2>&1'

  _port:available:windows:
    desc: Check if a port is available on Windows (internal)
    internal: true
    silent: true
    vars:
      PORT: '{{.PORT}}'
    platforms: [windows]
    cmds:
      - 'powershell -Command "if (Get-NetTCPConnection -LocalPort {{.PORT}} -ErrorAction SilentlyContinue) { exit 1 }"'

  default:
    desc: Show available tasks (default)
    cmds:
      - task --list
    silent: true

  # ============================================================================
  # Code Generation (API-First)
  # ============================================================================

  generate:
    desc: Generate all API artifacts from TypeSpec
    summary: |
      Generates all code artifacts from the TypeSpec API specification:
      - OpenAPI 3.1 specification
      - TypeScript types (@feedback/api-types)
      - JavaScript client SDK (@feedback/api-client-js)
      - JSON Schemas (@feedback/api-schemas)
    cmds:
      - task: api:generate:all

  generate:types:
    desc: Generate TypeScript types only
    cmds:
      - task: api:generate:types

  generate:check:
    desc: Verify all generated files are up to date
    cmds:
      - task: api:check

  clean:generate:
    desc: Clean all generated files
    cmds:
      - task: api:clean

  # ============================================================================
  # Installation
  # ============================================================================

  install:
    desc: Install all workspace dependencies
    cmds:
      - bun install

  _ensure-deps:
    desc: Ensure dependencies are installed (internal)
    cmds:
      - bun install
    status:
      - test -f {{.LIB_DIR}}/node_modules/.bin/rollup
    silent: true

  # Library tasks
  build:
    desc: Build the react-visual-feedback library (TypeScript)
    deps: [_ensure-deps]
    dir: '{{.LIB_DIR}}'
    cmds:
      - bun run build
    sources:
      - '{{.LIB_DIR}}/src/**/*.{ts,tsx}'
      - '{{.LIB_DIR}}/rollup.config.ts'
      - '{{.LIB_DIR}}/tsconfig.json'
      - '{{.LIB_DIR}}/package.json'
    generates:
      - '{{.LIB_DIR}}/dist/**/*.js'

  build:watch:
    desc: Build library in watch mode
    deps: [_ensure-deps]
    dir: '{{.LIB_DIR}}'
    cmds:
      - bun run build:watch

  # Example tasks
  dev:
    desc: Start example app with live development
    deps: [build] # build already depends on _ensure-deps
    dir: '{{.EXAMPLE_DIR}}'
    cmds:
      - bun run dev

  example:build:
    desc: Build example app
    deps: [build]
    dir: '{{.EXAMPLE_DIR}}'
    cmds:
      - bun run build

  example:start:
    desc: Start example production server
    dir: '{{.EXAMPLE_DIR}}'
    cmds:
      - bun run start

  # Development
  dev:full:
    desc: Run library build in watch mode and example dev server concurrently
    cmds:
      - task: build:watch
      - task: dev

  # Maintenance
  clean:
    desc: Clean all build artifacts
    cmds:
      - rm -rf {{.LIB_DIR}}/dist
      - rm -rf {{.EXAMPLE_DIR}}/.next
      - rm -rf node_modules
      - rm -rf {{.LIB_DIR}}/node_modules
      - rm -rf {{.EXAMPLE_DIR}}/node_modules

  clean:build:
    desc: Clean and rebuild everything
    cmds:
      - task: clean
      - task: install
      - task: build

  # ============================================================================
  # CI/CD
  # ============================================================================

  ci:
    desc: Run full CI pipeline
    summary: |
      Runs the complete CI pipeline:
      1. Install dependencies
      2. Generate API types
      3. Type check
      4. Lint
      5. Test
    cmds:
      - bun install --frozen-lockfile
      - task: generate
      - bun run --filter "*" typecheck
      - bun run --filter "*" lint
      - bun run --filter "*" test

  # ============================================================================
  # Server Tasks
  # ============================================================================

  server:dev:
    desc: Start feedback-server in development mode
    cmds:
      - bun run --filter "@react-visual-feedback/server" dev

  server:test:
    desc: Run feedback-server tests
    cmds:
      - bun run --filter "@react-visual-feedback/server" test

  server:build:
    desc: Build feedback-server
    cmds:
      - bun run --filter "@react-visual-feedback/server" build

  # Info
  info:
    desc: Show project information
    cmds:
      - echo "Workspace root = {{.ROOT_DIR}}"
      - echo "API package = {{.API_DIR}}"
      - echo "Generated packages = {{.GENERATED_DIR}}"
      - echo "Library = {{.LIB_DIR}}"
      - echo "Example = {{.EXAMPLE_DIR}}"
      - echo "Bun version = $(bun --version)"
      - echo "Node version = $(node --version)"

  # Testing
  check:
    desc: Run all checks (build, lint)
    cmds:
      - task: build
      - task: example:build

  # ============================================================================
  # Docker Compose - Smart Deployment Orchestration
  # ============================================================================

  deploy:
    desc: Deploy all services (build if needed, start if not running)
    summary: |
      Smart deployment that:
      1. Checks Docker is running
      2. Builds images only if Dockerfiles changed
      3. Starts services only if not already running

      This is the recommended way to deploy the stack.
    deps: [_docker:check, _docker:compose:check]
    cmds:
      - task: docker:build:smart
      - task: up:smart
      - task: health:wait

  deploy:fresh:
    desc: Clean deployment (rebuild all, fresh start)
    summary: |
      Forces a complete rebuild and restart:
      1. Stops all services
      2. Rebuilds all images without cache
      3. Starts services
      4. Waits for health checks

      Use this when you need a completely clean slate.
    prompt: This will stop services and rebuild everything. Continue?
    deps: [_docker:check, _docker:compose:check]
    cmds:
      - docker compose down --remove-orphans
      - docker compose build --no-cache
      - docker compose up -d
      - task: health:wait

  up:
    desc: Start all services with Docker Compose
    summary: |
      Starts the complete feedback system stack (SQLite mode):
      - Feedback Server (API)   â†’ http://localhost:{{.SERVER_PORT}}
      - Feedback WebUI          â†’ http://localhost:{{.WEBUI_PORT}}
      - Feedback Example        â†’ http://localhost:{{.EXAMPLE_PORT}}

      NOTE: Currently running in SQLite mode.
      PostgreSQL container exists but server code ignores it.
      See: packages/feedback-server/docs/spec/ADR-001-database-factory.md

      Use 'task logs' to view logs.
      Use 'task down' to stop.
    deps: [_docker:check, _docker:compose:check]
    cmds:
      - docker compose up -d
      - |
        echo ""
        echo "Services starting (SQLite mode)..."
        echo "  - Feedback Server:  http://localhost:{{.SERVER_PORT}}"
        echo "  - Feedback WebUI:   http://localhost:{{.WEBUI_PORT}}"
        echo "  - Feedback Example: http://localhost:{{.EXAMPLE_PORT}}"
        echo ""
        echo "Run 'task logs' to view logs"
        echo "Run 'task health' to check status"

  up:smart:
    desc: Start services only if not already running
    deps: [_docker:check, _docker:compose:check]
    status:
      - docker compose ps --format json 2>/dev/null | grep -q '"feedback-server".*"running"'
      - docker compose ps --format json 2>/dev/null | grep -q '"feedback-webui".*"running"'
      - docker compose ps --format json 2>/dev/null | grep -q '"feedback-example".*"running"'
    cmds:
      - task: up

  down:
    desc: Stop all services
    deps: [_docker:check]
    cmds:
      - docker compose down --remove-orphans

  down:volumes:
    desc: Stop all services and remove volumes (data loss!)
    prompt: 'âš ï¸  WARNING: This will DELETE ALL DATA including the database. Are you sure?'
    deps: [_docker:check]
    cmds:
      - docker compose down -v --remove-orphans
      - echo "All volumes removed. Next 'task up' will be a fresh start."

  restart:
    desc: Restart all services
    deps: [_docker:check]
    cmds:
      - docker compose restart

  restart:server:
    desc: Restart only the feedback-server
    deps: [_docker:check]
    cmds:
      - docker compose restart feedback-server

  logs:
    desc: View logs from all services
    deps: [_docker:check]
    cmds:
      - docker compose logs -f

  logs:server:
    desc: View logs from feedback-server only
    deps: [_docker:check]
    cmds:
      - docker compose logs -f feedback-server

  logs:webui:
    desc: View logs from feedback-webui only
    deps: [_docker:check]
    cmds:
      - docker compose logs -f feedback-webui

  logs:example:
    desc: View logs from feedback-example only
    deps: [_docker:check]
    cmds:
      - docker compose logs -f feedback-example

  status:
    desc: Show status of all services
    deps: [_docker:check]
    cmds:
      - docker compose ps

  health:
    desc: Check health of all services
    deps: [_docker:check]
    cmds:
      - |
        echo "Checking service health..."
        echo ""
        echo "Feedback Server (http://localhost:{{.SERVER_PORT}}):"
        curl -sf http://localhost:{{.SERVER_PORT}}/api/v1/health && echo " âœ… OK" || echo "  âŒ Not ready"
        echo ""
        echo "Feedback WebUI (http://localhost:{{.WEBUI_PORT}}):"
        curl -sf http://localhost:{{.WEBUI_PORT}}/health && echo " âœ… OK" || echo "  âŒ Not ready"
        echo ""
        echo "Feedback Example (http://localhost:{{.EXAMPLE_PORT}}):"
        curl -sf http://localhost:{{.EXAMPLE_PORT}}/ >/dev/null && echo "âœ… OK" || echo "  âŒ Not ready"

  health:wait:
    desc: Wait for all services to become healthy
    summary: |
      Polls health endpoints until all services respond.
      Timeout after 60 seconds.
    deps: [_docker:check]
    vars:
      MAX_ATTEMPTS: 30
      SLEEP_SECONDS: 2
    cmds:
      - |
        echo "Waiting for services to become healthy..."
        attempt=0
        while [ $attempt -lt {{.MAX_ATTEMPTS}} ]; do
          attempt=$((attempt + 1))
          echo "Attempt $attempt/{{.MAX_ATTEMPTS}}..."

          server_ok=0
          webui_ok=0
          example_ok=0

          curl -sf http://localhost:{{.SERVER_PORT}}/api/v1/health >/dev/null 2>&1 && server_ok=1
          curl -sf http://localhost:{{.WEBUI_PORT}}/health >/dev/null 2>&1 && webui_ok=1
          curl -sf http://localhost:{{.EXAMPLE_PORT}}/ >/dev/null 2>&1 && example_ok=1

          if [ $server_ok -eq 1 ] && [ $webui_ok -eq 1 ] && [ $example_ok -eq 1 ]; then
            echo ""
            echo "âœ… All services healthy!"
            echo "  - Server:  http://localhost:{{.SERVER_PORT}}"
            echo "  - WebUI:   http://localhost:{{.WEBUI_PORT}}"
            echo "  - Example: http://localhost:{{.EXAMPLE_PORT}}"
            exit 0
          fi

          sleep {{.SLEEP_SECONDS}}
        done

        echo ""
        echo "âŒ Timeout waiting for services. Check logs with 'task logs'"
        exit 1

  # ============================================================================
  # Docker - Smart Build Tasks (with source fingerprinting)
  # ============================================================================

  docker:build:
    desc: Build all Docker images
    deps: [_docker:check]
    cmds:
      - docker compose build

  docker:build:smart:
    desc: Build images only if Dockerfiles or source changed
    deps: [_docker:check]
    cmds:
      - task: docker:build:server:smart
      - task: docker:build:webui:smart
      - task: docker:build:example:smart

  docker:build:nocache:
    desc: Build all Docker images without cache
    deps: [_docker:check]
    cmds:
      - docker compose build --no-cache

  docker:build:server:
    desc: Build feedback-server Docker image
    deps: [_docker:check]
    cmds:
      - docker compose build feedback-server

  docker:build:server:smart:
    desc: Build feedback-server only if sources changed
    deps: [_docker:check]
    sources:
      - '{{.SERVER_DIR}}/Dockerfile'
      - '{{.SERVER_DIR}}/src/**/*.ts'
      - '{{.SERVER_DIR}}/package.json'
      - '{{.SERVER_DIR}}/tsconfig.json'
      - '{{.SERVER_DIR}}/drizzle.config.ts'
    generates:
      - '.task/checksum/docker-build-server'
    cmds:
      - docker compose build feedback-server
      - mkdir -p .task/checksum && touch .task/checksum/docker-build-server

  docker:build:webui:
    desc: Build feedback-webui Docker image
    deps: [_docker:check]
    cmds:
      - docker compose build feedback-webui

  docker:build:webui:smart:
    desc: Build feedback-webui only if sources changed
    deps: [_docker:check]
    sources:
      - '{{.WEBUI_DIR}}/Dockerfile'
      - '{{.WEBUI_DIR}}/src/**/*.{ts,tsx}'
      - '{{.WEBUI_DIR}}/package.json'
      - '{{.WEBUI_DIR}}/vite.config.ts'
      - '{{.WEBUI_DIR}}/tsconfig.json'
    generates:
      - '.task/checksum/docker-build-webui'
    cmds:
      - docker compose build feedback-webui
      - mkdir -p .task/checksum && touch .task/checksum/docker-build-webui

  docker:build:example:
    desc: Build feedback-example Docker image
    deps: [_docker:check]
    cmds:
      - docker compose build feedback-example

  docker:build:example:smart:
    desc: Build feedback-example only if sources changed
    deps: [_docker:check]
    sources:
      - '{{.EXAMPLE_DIR}}/Dockerfile'
      - '{{.EXAMPLE_DIR}}/src/**/*.{ts,tsx}'
      - '{{.EXAMPLE_DIR}}/package.json'
      - '{{.EXAMPLE_DIR}}/next.config.js'
      - '{{.EXAMPLE_DIR}}/tsconfig.json'
    generates:
      - '.task/checksum/docker-build-example'
    cmds:
      - docker compose build feedback-example
      - mkdir -p .task/checksum && touch .task/checksum/docker-build-example

  docker:push:
    desc: Push all Docker images to registry
    summary: |
      Push images to the configured registry.
      Set DOCKER_REGISTRY in .env to specify the registry.
    deps: [_docker:check]
    cmds:
      - docker compose push

  # ============================================================================
  # Docker - Cleanup Tasks
  # ============================================================================

  reset:
    desc: Stop services and remove all volumes (fresh start)
    prompt: 'âš ï¸  This will DELETE ALL DATA. Are you sure?'
    deps: [_docker:check]
    cmds:
      - docker compose down -v --remove-orphans
      - rm -rf .task/checksum
      - echo "All volumes and build checksums removed. Next 'task deploy' will be a fresh start."

  prune:
    desc: Remove unused Docker resources
    prompt: This will remove unused Docker images, containers, and volumes. Continue?
    deps: [_docker:check]
    cmds:
      - docker system prune -f
      - docker volume prune -f

  docker:clean:
    desc: Remove all project containers and images
    prompt: This will remove all project Docker images and containers. Continue?
    deps: [_docker:check]
    cmds:
      - docker compose down --rmi all -v --remove-orphans
      - rm -rf .task/checksum

  # ============================================================================
  # Docker - Database Tasks (SQLite mode)
  # ============================================================================
  # NOTE: PostgreSQL tasks are commented out as the server currently uses SQLite.
  # See: packages/feedback-server/docs/spec/ADR-001-database-factory.md

  db:info:
    desc: Show current database configuration
    cmds:
      - |
        echo "Database Configuration"
        echo "======================"
        echo ""
        echo "Mode: SQLite (hardcoded in server code)"
        echo "Path: /app/data/feedback.db (inside container)"
        echo "Volume: feedback-data (Docker volume)"
        echo ""
        echo "NOTE: PostgreSQL support exists in db/factory.ts but is not wired up."
        echo "See: packages/feedback-server/docs/spec/ADR-001-database-factory.md"

  db:shell:
    desc: Open SQLite shell in server container
    deps: [_docker:check]
    preconditions:
      - sh: docker compose ps --format json | grep -q '"feedback-server".*"running"'
        msg: "feedback-server is not running. Start with 'task up' first."
    cmds:
      - docker compose exec feedback-server sqlite3 /app/data/feedback.db

  db:backup:
    desc: Create database backup
    deps: [_docker:check]
    preconditions:
      - sh: docker compose ps --format json | grep -q '"feedback-server".*"running"'
        msg: "feedback-server is not running. Start with 'task up' first."
    vars:
      BACKUP_FILE: 'backups/feedback-{{now | date "2006-01-02-150405"}}.sqlite'
    cmds:
      - mkdir -p backups
      - docker compose cp feedback-server:/app/data/feedback.db {{.BACKUP_FILE}}
      - 'echo "âœ… Backup created: {{.BACKUP_FILE}}"'

  db:restore:
    desc: Restore database from backup
    summary: |
      Restore SQLite database from a backup file.

      Usage:
        task db:restore FILE=backups/feedback-2024-01-15.sqlite
    deps: [_docker:check]
    prompt: 'âš ï¸  This will OVERWRITE the current database. Are you sure?'
    requires:
      vars: [FILE]
    preconditions:
      - sh: test -f {{.FILE}}
        msg: 'Backup file not found: {{.FILE}}'
      - sh: docker compose ps --format json | grep -q '"feedback-server".*"running"'
        msg: "feedback-server is not running. Start with 'task up' first."
    cmds:
      - docker compose cp {{.FILE}} feedback-server:/app/data/feedback.db
      - docker compose restart feedback-server
      - 'echo "âœ… Database restored from {{.FILE}}"'

  # ============================================================================
  # Docker - Shell Access
  # ============================================================================

  shell:server:
    desc: Open shell in feedback-server container
    deps: [_docker:check]
    preconditions:
      - sh: docker compose ps --format json | grep -q '"feedback-server".*"running"'
        msg: "feedback-server is not running. Start with 'task up' first."
    cmds:
      - docker compose exec feedback-server /bin/sh

  shell:webui:
    desc: Open shell in feedback-webui container
    deps: [_docker:check]
    preconditions:
      - sh: docker compose ps --format json | grep -q '"feedback-webui".*"running"'
        msg: "feedback-webui is not running. Start with 'task up' first."
    cmds:
      - docker compose exec feedback-webui /bin/sh

  shell:example:
    desc: Open shell in feedback-example container
    deps: [_docker:check]
    preconditions:
      - sh: docker compose ps --format json | grep -q '"feedback-example".*"running"'
        msg: "feedback-example is not running. Start with 'task up' first."
    cmds:
      - docker compose exec feedback-example /bin/sh

  # ============================================================================
  # Validation & Diagnostics
  # ============================================================================

  validate:
    desc: Validate entire deployment configuration
    summary: |
      Checks:
      1. Docker is running
      2. docker-compose.yml is valid
      3. Required files exist
      4. Environment is configured correctly
    cmds:
      - task: _docker:check
      - task: _docker:compose:check
      - |
        echo "Validating configuration..."
        echo ""

        # Check docker-compose.yml
        echo "ðŸ“„ docker-compose.yml:"
        docker compose config --quiet && echo "  âœ… Valid" || echo "  âŒ Invalid"

        # Check Dockerfiles exist
        echo ""
        echo "ðŸ“¦ Dockerfiles:"
        test -f packages/feedback-server/Dockerfile && echo "  âœ… feedback-server/Dockerfile" || echo "  âŒ feedback-server/Dockerfile missing"
        test -f packages/feedback-server-webui/Dockerfile && echo "  âœ… feedback-server-webui/Dockerfile" || echo "  âŒ feedback-server-webui/Dockerfile missing"
        test -f packages/feedback-example/Dockerfile && echo "  âœ… feedback-example/Dockerfile" || echo "  âŒ feedback-example/Dockerfile missing"

        # Check environment
        echo ""
        echo "ðŸ”§ Environment:"
        test -f .env && echo "  âœ… .env file exists" || echo "  âš ï¸  No .env file (using defaults)"

        echo ""
        echo "âœ… Validation complete"

  diag:
    desc: Run full diagnostics on the deployment
    aliases: [diagnostics]
    summary: |
      Comprehensive diagnostics including:
      - Service status
      - Container health
      - Port usage
      - Resource usage
      - Recent logs
    deps: [_docker:check]
    cmds:
      - |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  React Visual Feedback - Deployment Diagnostics"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""

        echo "ðŸ“Š Service Status"
        echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        docker compose ps
        echo ""

        echo "ðŸ” Container Health"
        echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        task health
        echo ""

        echo "ðŸŒ Port Usage"
        echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        echo "  Server port {{.SERVER_PORT}}:"
        lsof -i :{{.SERVER_PORT}} 2>/dev/null | head -3 || echo "    Not in use"
        echo ""
        echo "  WebUI port {{.WEBUI_PORT}}:"
        lsof -i :{{.WEBUI_PORT}} 2>/dev/null | head -3 || echo "    Not in use"
        echo ""
        echo "  Example port {{.EXAMPLE_PORT}}:"
        lsof -i :{{.EXAMPLE_PORT}} 2>/dev/null | head -3 || echo "    Not in use"
        echo ""

        echo "ðŸ’¾ Volume Usage"
        echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        docker volume ls --filter name=react-visual-feedback 2>/dev/null || echo "  No volumes found"
        echo ""

        echo "ðŸ“ Recent Logs (last 10 lines per service)"
        echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        echo ""
        echo "feedback-server:"
        docker compose logs --tail=10 feedback-server 2>/dev/null || echo "  No logs available"
        echo ""
        echo "feedback-webui:"
        docker compose logs --tail=10 feedback-webui 2>/dev/null || echo "  No logs available"
        echo ""
        echo "feedback-example:"
        docker compose logs --tail=10 feedback-example 2>/dev/null || echo "  No logs available"
