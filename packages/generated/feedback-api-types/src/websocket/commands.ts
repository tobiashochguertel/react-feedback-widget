/**
 * WebSocket Client Commands - TypeScript Types
 *
 * DO NOT EDIT THIS FILE DIRECTLY
 * These types are derived from TypeSpec definitions in:
 * - packages/feedback-server-api/typespec/websocket/commands.tsp
 *
 * Run `bun run generate:types` to regenerate if TypeSpec changes.
 *
 * @module @feedback/api-types/websocket/commands
 */

// ============================================================================
// Client Command Types (Client â†’ Server)
// ============================================================================

/**
 * Base interface for all client commands
 */
export interface BaseClientCommand {
  /** Command type discriminator */
  type: string;
}

/**
 * Filters for feedback subscriptions
 */
export interface SubscriptionFilters {
  /** Filter by feedback status */
  status?: string[];
  /** Filter by feedback priority */
  priority?: string[];
  /** Filter by feedback tags */
  tags?: string[];
  /** Filter by date range (ISO 8601) */
  dateRange?: {
    start?: string;
    end?: string;
  };
}

/**
 * Subscribe to events for a channel
 *
 * Channels:
 * - 'feedback': All feedback events
 * - 'feedback:{id}': Events for a specific feedback item
 */
export interface SubscribeCommand extends BaseClientCommand {
  type: 'subscribe';
  /** Channel to subscribe to */
  channel: string;
  /** Optional filters for the subscription */
  filters?: SubscriptionFilters;
}

/**
 * Unsubscribe from a channel
 */
export interface UnsubscribeCommand extends BaseClientCommand {
  type: 'unsubscribe';
  /** Channel to unsubscribe from */
  channel: string;
}

/**
 * Ping to keep connection alive
 *
 * Server will respond with PongEvent
 */
export interface PingCommand extends BaseClientCommand {
  type: 'ping';
}

/**
 * Authenticate the WebSocket connection
 *
 * Should be sent immediately after connection if auth is required
 */
export interface AuthenticateCommand extends BaseClientCommand {
  type: 'authenticate';
  /** JWT token or API key */
  token: string;
}

// ============================================================================
// Union Types
// ============================================================================

/**
 * All possible client command types
 *
 * Use this type for type-safe command sending:
 * ```typescript
 * function sendCommand(ws: WebSocket, command: ClientCommand) {
 *   ws.send(JSON.stringify(command));
 * }
 *
 * sendCommand(ws, {
 *   type: 'subscribe',
 *   channel: 'feedback',
 *   filters: { status: ['new', 'in_progress'] }
 * });
 * ```
 */
export type ClientCommand =
  | SubscribeCommand
  | UnsubscribeCommand
  | PingCommand
  | AuthenticateCommand;

/**
 * Map of command type strings to command interfaces
 * Useful for type-safe command handler maps
 */
export interface ClientCommandMap {
  subscribe: SubscribeCommand;
  unsubscribe: UnsubscribeCommand;
  ping: PingCommand;
  authenticate: AuthenticateCommand;
}

/**
 * All client command type strings
 */
export type ClientCommandType = keyof ClientCommandMap;

// ============================================================================
// Type Guards
// ============================================================================

/**
 * Type guard for SubscribeCommand
 */
export function isSubscribeCommand(command: ClientCommand): command is SubscribeCommand {
  return command.type === 'subscribe';
}

/**
 * Type guard for UnsubscribeCommand
 */
export function isUnsubscribeCommand(command: ClientCommand): command is UnsubscribeCommand {
  return command.type === 'unsubscribe';
}

/**
 * Type guard for PingCommand
 */
export function isPingCommand(command: ClientCommand): command is PingCommand {
  return command.type === 'ping';
}

/**
 * Type guard for AuthenticateCommand
 */
export function isAuthenticateCommand(command: ClientCommand): command is AuthenticateCommand {
  return command.type === 'authenticate';
}

// ============================================================================
// Helper Functions
// ============================================================================

/**
 * Create a subscribe command
 */
export function createSubscribeCommand(channel: string, filters?: SubscriptionFilters): SubscribeCommand {
  return {
    type: 'subscribe',
    channel,
    ...(filters && { filters }),
  };
}

/**
 * Create an unsubscribe command
 */
export function createUnsubscribeCommand(channel: string): UnsubscribeCommand {
  return {
    type: 'unsubscribe',
    channel,
  };
}

/**
 * Create a ping command
 */
export function createPingCommand(): PingCommand {
  return { type: 'ping' };
}

/**
 * Create an authenticate command
 */
export function createAuthenticateCommand(token: string): AuthenticateCommand {
  return {
    type: 'authenticate',
    token,
  };
}
